"use strict";(()=>{var e={};e.id=661,e.ids=[661],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4718:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8838:(e,r,t)=>{t.r(r),t.d(r,{config:()=>c,default:()=>u,routeModule:()=>d});var n={};t.r(n),t.d(n,{default:()=>l});var i=t(9762),o=t(6059),a=t(4718),s=t(1988);async function l(e,r){if("GET"!==e.method)return r.setHeader("Allow",["GET"]),r.status(405).json({error:"Method not allowed"});let t=await (0,s.Y)(e,r);if(t)return r.json({user:{id:t.userId,email:t.email,name:t.name,microsoftId:t.microsoftId}})}let u=(0,a.l)(n,"default"),c=(0,a.l)(n,"config"),d=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/auth/me",pathname:"/api/auth/me",bundlePath:"",filename:""},userland:n})},6059:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},9762:(e,r,t)=>{e.exports=t(145)},1988:(e,r,t)=>{t.d(r,{Y:()=>i});var n=t(4580);async function i(e,r){try{let t=function(e){let r=e.headers.authorization||e.headers.Authorization;return r&&r.startsWith("Bearer ")?r.replace("Bearer ",""):null}(e);if(!t)return r.status(401).json({error:"Access denied. No token provided."}),null;let i=await fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer "+t}});if(!i.ok)return r.status(401).json({error:"Invalid Microsoft token"}),null;let o=await i.json(),a=await (0,n.z)(),s=await a.collection("users").findOne({microsoftId:o.id});if(!s)return r.status(401).json({error:"User not found in system"}),null;return{userId:s.id,microsoftId:s.microsoftId,email:s.email,name:s.name}}catch(e){return console.error("Token verification error:",e),r.status(500).json({error:"Failed to verify token"}),null}}},4580:(e,r,t)=>{t.d(r,{z:()=>c});let n=require("node:fs"),i=require("node:path"),o=require("node:url"),a=require("mongodb");!function(){if(process.env.MONGODB_URI)return;let e=i.dirname((0,o.fileURLToPath)("file:///C:/Users/User/Downloads/Habit-Tracker-Web-Project-main(1)/Habit-Tracker-Web-Project-main/server/lib/mongodb.js"));for(let r of[i.join(process.cwd(),".env.local"),i.join(process.cwd(),".env"),i.join(e,"../.env.local"),i.join(e,"../../.env.local")])if((0,n.existsSync)(r))for(let e of(0,n.readFileSync)(r,"utf-8").split(/\r?\n/)){let r=e.trim();if(!r||r.startsWith("#"))continue;let t=r.indexOf("=");if(-1===t||"MONGODB_URI"!==r.slice(0,t).trim())continue;let n=r.slice(t+1).trim();if(!n)continue;let i=n;if((i.startsWith('"')&&i.endsWith('"')||i.startsWith("'")&&i.endsWith("'"))&&(i=i.slice(1,-1)),i=i.trim()){process.env.MONGODB_URI=i;return}}}();let s=process.env.MONGODB_URI;if(!s)throw Error("MONGODB_URI environment variable is not defined");let l=null,u=null;async function c(){return u||(l||(l=new a.MongoClient(s,{serverApi:{version:a.ServerApiVersion.v1,strict:!0,deprecationErrors:!0}}).connect()),u=(await l).db("habit-tracker"))}}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=8838);module.exports=t})();